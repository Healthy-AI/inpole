Bootstrap: docker

From: continuumio/miniconda3:latest

%post
    # @TODO: Install CPLEX.

    # Install gcc.
    apt-get update && apt-get install -y gcc

    # Clone the risk-slim repository.
    git clone https://github.com/ustunb/risk-slim.git

    # Install conda packages.
    cp -r /mnt/inpole .
    cd inpole
    . /opt/conda/etc/profile.d/conda.sh
    conda env create -f environment.yml

    # Install other packages using Poetry.
    env_name=$(head -1 environment.yml | cut -d' ' -f2)
    conda activate $env_name
    poetry install

    # Activate the environment when the container is run.
    echo ". /opt/conda/etc/profile.d/conda.sh" >> $SINGULARITY_ENVIRONMENT
    echo "conda activate $env_name" >> $SINGULARITY_ENVIRONMENT
    